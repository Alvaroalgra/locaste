<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
    <style>
        body, h1, h2, h3, h4, h5 {
            font-family: "Raleway", sans-serif
        }
    </style>
    <title class="w3-container w3-red">Voting list</title>
</head>
<body>
<header id="voting_management">
    <div class="w3-container">
        <h1><b>VOTING MANAGEMENT</b></h1>
        <div class="w3-section w3-bottombar w3-padding-16">
            <a href="/voting/list" class="w3-bar-item w3-button w3-padding w3-black"><i class="fa fa-list fa-fw"></i> List</a>
            <a href="/voting/create" class="w3-bar-item w3-button w3-padding w3-black"><i
                    class="fa fa-plus-circle fa-fw"></i> New Voting</a>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.3.1.js"
        integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
        crossorigin="anonymous"></script>
</header>
<form method="post" id="formulary" action="/voting/create/" onsubmit="return checkRestrictions($('#id_custom_url').val(), $('#id_max_age').val(), $('#id_min_age').val());">
    <div id="content" class="w3-container w3-padding-large w3-white">
        {% csrf_token %}
        <div id="fields">
            {% for field in form %}
                {% if field.name in "me" %}
                    <input id="defaultMe" type="hidden" name="{{ field.name }}" value="off"/>
                {% endif %}
                {{ field.label }}
                {{ field }}

                <br/>
            {% endfor %}

            <br/>
        </div>
    </div>
    {% if error %}
        <p style = "color: red"><b>{{ error_message }}</b></p>
    {% endif %}
    {% if is_auth %}
        <button class="w3-button w3-black w3-margin-bottom" type="button" onclick="add_auth();">Add auth</button>
    {% endif %}
    <input class="w3-button w3-black w3-margin-bottom" type="submit" value="Create"/>
    </div>
</form>
<script>
    function add_auth() {
        var question_formulary = $('#fields').clone().first();
        var empty_input = question_formulary.find('input');
        for (var i = 0; i < empty_input.length; i++) {
            if ($(empty_input[i]).attr("type") == 'checkbox') {
                $(empty_input[i]).prop("checked", false);
            } else if ($(empty_input[i]).attr("type") != 'hidden') {
                $(empty_input[i]).val("")
            }
        }
        question_formulary.append("<button type=\"button\" onclick=\"remove_element(event);\">X</button>");
        $('#content').append(question_formulary);
    }

    function remove_element(event) {
        $(event.target).parent().remove();
    }

    function checkRestrictions(customUrlValue, maxAgeValue, minAgeValue) {
        let result = true;

        // This checks that no '/' are contained in custom url
        if (String(customUrlValue).includes('/')) {
            window.alert('Field \'custom URL\' contains forbidden character: \'/\'');
            result = false;
            // This checks that no whitespaces are contained in custom url
        } else if (/\s/.test(String(customUrlValue))) {
            window.alert('Field \'custom URL\' cannot contain whitespaces');
            result = false;
        } else if (maxAgeValue < minAgeValue) {
            window.alert('Max age cannot be lower than min age');
            result = false;
        }

        return result;
    }

</script>
</body>